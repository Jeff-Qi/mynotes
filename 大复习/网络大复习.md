##  Day 1

### OSI七层模型
1.  应用层
2.  表示层
3.  会话层
4.  传输层
5.  网络层
6.  数据链路层
7.  物理层

### TCP
1. 三次握手、四次挥手
2. 滑动窗口
3. 有限状态机
4. 序列号确认号
    - 发送端： seq = 前一次收到的ack；ack = 自己的 ack
    - 接收端： seq = 自己的sqe；ack = 收到的数据大小 + 收到的 seq
    - 序列号和确认号可以保证传输的可靠性，发送方发送数据时可以按照顺序发送数据包；接收方可以按照序列号将数据包顺序组装；序列号可以告诉接收方发送的是哪一个数据包，确认号可以告诉发送方，我已经确认接收了那些数据包，下一次需要从哪个数据包开始发送。

### ARP
1.  ARP:地址解析协议，将IP地址转换成对应的mac地址，完成IP地址到Mac地址的映射；
    - 工作流程：a向b发送数据，首先查询本地的ip地址到mac地址的缓存，如果有直接发送；如果没有，发起广播发起广播查询，带上自己的ip、mac地址和目的ip地址；其他主机收到信息查看ip地址是否是自己的，不是则丢弃；如果是则将a的ip和mac地址映射存入arp缓存，并将自己的mac地址信息发送会给主机a；主机收到信息后，将b的ip与mac地址信息存入缓存；发送信息；
1. 反向ARP
    - 根据源设备 MAC 地址通过广播获取 IP地址的过程的地址解析协议；
2. 代理ARP
    - 代理arp 即arp 欺骗，路由器通过发送代理arp 信息，让主机认为路由器即为目的主机。通过这种方式，路由器可以转发数据流。
3. ARP欺骗的原理
    - ARP欺骗利用的是ARP缓存机制的一个缺陷。当主机收到一个ARP响应包时，主机不会去确认是否有想这个IP地址发送过ARP请求；会直接将对应的IP和mac地址存入到arp缓存中，如果原来存在这个IP则会替换原来的映射关系；

### DNS
1.  DNS：能够将域名与 IP 地址进行相互转换
2.  查询方式
    1.  迭代查询：主机箱本地 DNS 服务器发起域名解析，如果本地 DNS 服务器不知道，则向根 DNS 服务器发起查询，根域名服务器如果不知道，则将自己知道的顶级 DNS 服务器的地址发送给本地服务器，让他去其他顶级服务器查询；
    2.  递归查询：主机向本地 DNS 服务器请求域名解析，如果本地 DNS 服务器不知道，则本地 DNS 服务器将以 DNS 客户的身份将该条解析传递给下一个根域名服务器（常用）；
3. 端口号，TCP/UDP
    - 53端口
4. 什么状况下用TCP
    - DNS 服务器分为，主 DNS 服务器和辅助 DNS 服务器；主 DNS 服务器读取自己本地的关于本区域的 DNS 信息，辅助 DNS 服务器从该区域的主 DNS 服务器获取 DNS 信息；**DNS服务器之间传输时使用TCP，而客户端与DNS服务器之间传输时用的是UDP**；

### 常见协议端口号（默认UDP/TCP两种协议）
1. FTP：20（发送指令）、21（文件传输）
2. DNS：53
3. DHCP：67/UDP（目的端口/接收）、68/UDP（源端口/发送）
4. HTTP：80/TCP    HTTPS：443
5. Telnet：23/TCP
6. ssh：22/TCP

### DHCP

1. 过程
    1.  发现阶段：客户端广播发送 DHCP discover 消息请求；
    2.  提供阶段：DHCP 服务器收到 DHCP discover 后，从地址池中选出一个 IP 地址，以广播的形式发送 DHCP offer 消息给客户端；
    3.  选择阶段：客户端收到 DHCP offer 后以广播的形式发送一个 DHCP request 消息。这个消息是想向 DHCP 服务器申请 DHCP offer 中的 IP 地址；有可能会收到多个 DHCP 服务器的offer，一般客户端会选择第一个到达的，其他的 DHCP 服务器收到这个 request 信息后，知道客户端拒绝了自己的 offer，所以开始回收自己的 offer；
    4.  确认阶段：DHCP 服务器收到客户端发送的 request 信息，以单播的形式回复 DHCP ack 信息给客户端确认分配这个 IP 地址，并从自己的地址池中删除这个 IP 地址；
2. 续租时间
    1.  客户端获取 IP 地址成功后，会在 1/2 租约时间的时候发送 request 信息，向 DHCP 服务器请求续约
    2.  服务器收到客户端发送的 DHCP request 信息会回复一个 DHCP ack 信息，客户端收到后就表示续约成功，从当前时间算起或得一个新的租约期限；如果客户端没有收到 DHCP ack 信息，或者服务端没有收到客户端的 DHCP request 报文，客户端会在到达租约 7/8 的时候再次发送 DHCP request 报文，请求续组，如果成功则在当前时间基础上获得一个新的租约周期
    3.  如果第二次也没有成功只有等到租约结束后，重新申请新的 IP 地址
    4.  如果在 1/2 租约是发起续组请求，DHCP 服务端已经不存在这个 IP，则 DHCP 服务器会单播发送 DHCP nack 信息，客户端收到后会发送 DHCP discover 信息，如果没有回复，在 7/8 租约时再次发送 DHCP discover 包，如果没有成功，只有在过期后重新获取 IP

### NAT
1.  NAT 技术能够将数据包中的 IP 地址进行替换，使是有网络能够访问公网；同时极大的缓解了 IPv4 地址紧缺的问题；保护内网安全
2.  NAT 优缺点

优点 | 缺点
---|---
节省 IP 地址 | 增加转发延迟
解决 IP 地址重叠 | 丧失端到端之间的通信能力
增加接入 Internet 的弹性 | 部分应用不支持 NAT
网络变更减少重编址 | 需要部分内存空间来存储 NAT 转换表
对外影藏自己的内部地址，安全 | 需要 CPU 进行 NAT 操作、需要内存资源存储 NAT 信息

2. SNAT：静态 NAT
    1.  内部地址与全局地址一一对应；缺点是一个内网 IP 独占一个公网 IP；即使没有使用的时候，也不能给其他人使用；可扩展性不高；
    2.  支持 IP 到 IP 的映射；端口到端口的映射

3.  s-nat \ d-nat：数据报的源地址和目的地址的转化，并保存修改前后映射关系
    1. S-NAT
        1.  流量出去时改源地址（snat）；回来时改目的地址（un_snat）
    2. D-NAT
        1.  流量进来时改目的地址（dnat）；出去时改源地址（un_nat）
4. PAT：端口地址转换
    1.  对数据包的源地址和端口均进行转换，通过这种转换，可以使多个内部本地地址同时共享同一个公网地址，通过 IP + 端口的方式来识别不通的源，也就是多对一的映射。
5. 解决地址冲突问题
    1.  当 NAT 地址池中的地址用完后，其他未获得 IP 地址的主机无法 NAT 只能等待有 IP 地址空闲后才能进行 NAT
    2.  使用 PNAT

### IP编址
1.  1.0.0.0~126.255.255.255 私有地址：10.0.0.0~10.255.255.255
2.  127.0.0.0~191.255.255.255 私有地址：172.16.0.0~172.31.255.255
3.  192.0.0.0~224.255.255.255 私有地址：192.168.0.0~192.168.255.255
1. 子网掩码
      - 用于标识一个 IP 那些是主机所在网段，那些标识位是主机的位掩码
      - IP 地址由子网掩码分为两部分：网络号和主机号；网络号用来确定所属网段；主机号用来唯一标识主机；
      - 主机位全为 0 的地址，称为网络地址，表示一个网段；
      - 主机位全为 1 的地址，称为广播地址；
      - 作用：
          1.  将一个大的 IP 网段，划分成小的 IP 网段，节约地址；减少 IP 地址的浪费；
          2.  屏蔽 IP 的一部分以区别网络标识，和主机标识；说明该主机实在局域网上，还是在远程网；
2. VLSM/CIDR
    1.  VLSM：可变长子网掩码
        1.  在一个主类(A、B、C类)网络内包含多个子网掩码的能力，以及对一个子网的再进行子网划分的能力
        2.  作用：节约 IP 地址空间；减小路由表的大小；
    2.  CIDR：无类别域间路由
        1.  取消IP地址的分类结构，将多个地址块聚合在一起生成一个更大的网络，以包含更多的主机

## Day 2

### 路由原理
1.  接入到几个不同的网络之中，通过检查数据包的 IP 地址信息然后通过与路由表里面的信息进行对比，决定发送到的下一跳该往哪里走；可以实现不同网段的通信；
2.  路由表：路由表是路由器工作的基础，存储着路由信息，记录网络中的地址记录，记录着网络的拓扑信息，决定着数据的转发路径；
3.  路由汇总：将多个明细路由汇集成一个路由广播，减少路由器维护的路由表条数；

### 静态路由
1.  手工指定路由器转发某个网络的数据包下一次该往哪里走；一般由管理员手工添加，比较稳定，不会发生改变；
2.  缺省路由：设置一条缺省路由，在路由器对比过路由表之后没有找到相应的路由条目时，会将数据包发送给默认的转发接口
3.  下一跳出口导致ARP问题：如果静态路由指定的下一跳借口，则会认为对面的接口和自己是同一网段的。于是会发起 ARP 请求，如果对方开启了 ARP 代理，则会回复 ARP 请求的目的 MAC 就是自己的直连的端口；如果没有那么就无法通信；如果这个路由器要访问的是对端路由器后面的主机，访问一台主机就会缓存一个 PC 和他的 MAC 地址对应信息，如果主机量过于庞大，这会耗尽这个路由器的内存；为了解决我们可以采用下一跳地址的方式指定静态路由，每次只需要维护一个 ARP 缓存记录；
4.  管理距离：不同的协议有自己不同的计算度量值得方法，如 RIP 通过条数来决定路径的传输距离，EIGRP 通过计算网络中的带宽和延迟来计算传输距离；没有可比性，通过统一单位，来衡量不同协议的路径开销，从而来选择最优路径；

### RIP（520/UDP、路由矢量、内部网关协议、报文 30s 、广播更新、180s 未更新记为不可达）
1.  距离矢量路由协议，通过衡量条数来衡量网络距离
2.  直连设备距离为 0，中间经过了多少个路由器距离就加几，最大 15 跳，16 跳时不可达；
3.  特点：有类别路由协议；广播更新；基于UDP，端口号520
3.  RIP1 与 RIP2
    1.  RIPv1是有类路由协议，RIPv2是无类路由协议
    2.  RIPv1不能支持VLSM，RIPv2可以支持VLSM
    3.  RIPv1没有认证的功能，RIPv2可以支持认证，并且有明文和MD5两种认证
    4.  RIPv1没有手工汇总的功能，RIPv2可以在关闭自动汇总的前提下，进行手工汇总
    5.  RIPv1是广播更新，RIPv2是组播更新，
    6.  RIPv1对路由没有标记的功能，RIPv2可以对路由打标记（tag），用于过滤和做策略
    7.  RIPv1发送的updata最多可以携带25条路由条目，RIPv2在有认证的情况下最多只能携带24条路由
    8.  RIPv1发送的updata包里面没有next-hop属性，RIPv2有next-hop属性，可以用与路由更新的重定
4.  防环机制
    1.  水平分割：从邻居学到的路由表，不会再发给邻居；减少网络消耗，防止路由环路
    2.  毒性翻转：从邻居学到的路由表，发回给邻居，没发送一次跳数加 1，到达 16 跳后认为不可达
    3.  记最大跳数：定义最大跳数 16 跳不可达
    4.  路由毒化：当拓扑发生改变时，将失效路由标记为不可达
    5.  触发更新：一旦检测到路由崩溃，立即广播路由刷新报文，而不等到下一刷新周期
    6.  抑制计时器：防止路由表频繁翻动，增加网络稳定性 ，阻止定期更新的消息在不恰当的时间内重置一个已经坏掉的路由

### OSPF（链路状态路由协议、内部网关协议、89、IP、组播更新224.0.0.5、224.0.0.6）
1.  COST＝参考带宽（10的8次方）/ 接口带宽
1.  OSPF 三张表：
    1.  邻居表
    2.  LSDB
    3.  路由表
1. 距离矢量与链路状态
    1.   每个节点接收来自与其直接邻接节点的路由信息，并执行路由计算，将计算结果回传给直接邻接的节点，收敛慢；链路状态是记录的整个网络的拓扑结构，节点向相邻网络广播自己和邻居的信息，每当收到自己的信息后就计算网络拓扑，找出最优路径，收敛快，无环路；
2. OSPF原理
    1.  开机后会向周围链接的路由器发送 hello 包建立邻居关系，建立后发送 LSA,告诉自己的邻居自己的邻居路由器和自己的链路状态信息，这个过程中，路由器会不断的发送 LSA，记录 LSA，转发 LSA,最后形成链路状态数据库，形成拓扑接图，通过 SPF 算法计算 LSDB 得出最优路径形成路由表
3. OSPF的邻居建立过程7个步骤
    1.  down、init、towway（选举DR、BDR）、ex-start（决定主从）、exchange、loading、full
4. OSPF的LSA种类1,2,3,4,5,7需要看
    1.  （1）路由器LSA Router LSA：区域中路由产生，允许在本区域内洪泛，不允许跨越ABR
    2.  （2）网络LSA Network LSA：DR生成，描述其在该网络上连接的所有路由器以及网段掩码信息；只在本区域Area内洪泛，不允许跨越ABR
    3.  （3）网络汇总LSA Network Summary LSA：ABR产生的连接区域的汇总信息；通知本区域通往域外的信息
    4.  （4）ASBR Summary LSA：ABR 产生，主机 LSA，指向 ASBR 路由器
    5.  （5）自治系统外LSA AS External LSA：ASBR 产生，告诉本自治区的路由器通往外部自治区的路径；外部路由通过重发布，引入OSPF路由域，由 ASBR 生成五类的 LSA 发送进 OSPF 区域；不允许进入 stub 存根区 & NSSA区
        1.  OE2 开销= 外部开销；
        2.  OE1 开销= 外部开销+ 内部开销；
    7.  （7）NSSA中的外部LSA NSSA External LSA：在 NSSA 区域中 ASBR 针对外部网络产生类似于 LSA5 的 LSA 类型7；LSA类型7只能在NSSA区域中洪泛，到达NSSA区域ABR后，NSSA ABR将其转换成LSA类型5外部路由，传播到 Area 0，从而传播到整个OSPF路由域
5.  特殊区域拒绝的 LSA：
    1.  stub：LSA4、LSA5
    2.  totally stub：LSA3、LSA4、LSA5（默认类似 LSA3 的默认路由）
    3.  not-so-stub：LSA4、LSA5、LSA7（允许，进过 ABR 7类 转 5类）
    4.  totally-not-so-stub：只有 LSA2、LSA1、ABR下发一条类似 LSA3 的默认路由
6.  虚链路：
    1.  在某个非骨干区域上发生了区域分裂，导致某个非骨干区域无法和骨干区域相连，就需要虚链路；通过建立虚拟通道可以建立Area 0的邻居关系
5. OSPF的路由认证HMAC的过程
    1.  MD5 HMAC 的使用表明使用一个共享的密钥用于产生hash值.路由器发送一个消息产生MD5 hash值,并将它置于要发送的通告中,在接收时,接受方使用相同的密钥和MD5值,重新计算分组内容和分组头的hash值,如果结果相同,这个消息就是真正来自于一个可信赖的主机,如果不相同,它必须丢弃
6. OSPF区域划分问题

## Day 3

### ACL
1.  标准 acl 和扩展 acl
    1.  ACL默认在最后拒绝所有
    2.  标准访问列表只拒绝或允许原IP地址
    3.  扩展ACL的筛选更加精确广泛
    4.  ACL列表写好后，需要运用到接口上，标准ACL离目的IP更近，扩展ACL应用在离源IP更近的接口
    5.  ACL不会过滤自身路由器的信息
1. 过滤特定协议
    1. ICMP：protocol ICMP
    2. HTTP：protocol tcp port 80 /eq www
    3. OSPF：protocol ip port 89 /
    4. DHCP：protocol udp eq bootps

### BGP
1.  为什么要使用 BGP：
    1.  大量路由需要承载，BGP能够容纳上万条
    2.  策略能力强大，可以很好的实现路由策略与数据控制
2.  条件：自治区AS号、建立TCP链接、指定可达
3.  
1. 179/TCP
2. 选路原则能报出多少种
    1.  优选具有最大Weight值的路由（weight 不传递）
    2.  优选具有最大Local_Pref值的路由（IBGP 传递）
    3.  优选起源于本地的路由
    4.  as-path最短
    5.  ORIGIN
    6.  优选MED最小的路由
    7.  优选EBGP邻居的路由（相对于IBGP）
    8.  优选到NEXT_HOP最近的路由
    9.  BGP负载均衡
    10. 优选最老的EBGP邻居的路由
    11. 优选ROUTE-ID最小的
    12. 优选Cluster_List最短的路由
    13. 优选邻居IP地址最小的
4.  属性
    1.  公认属性
        1.  比遵：BGP必须识别，信息必须要包含
        2.  自觉：BGP能识别，可不包含
    2.  可选属性
        1.  可传递：可以不支持，但是传递时都需要传递
        2.  不可传递：可以不支持，可以在传递时忽略不传递
3. community属性：可选传递属性，不支持该属性的BGP router原封不动的将community值传递给下游BGP邻居
    1.  no-advertise：不发给其他任何BGP peer
    2.  no-export：不传递给任何EBGP peer（联邦EBGP会传递）
    3.  local-as：只在本AS内传递（如果定义了联邦会在联邦成员中传递）
    4.  atomic_aggregate及aggregator：汇总路由丢失明细路由的路径属性，需要给下游邻居警告，提示汇总地及汇总地AS

### 路由策略
1. ACL
    1.  标准 ACL
        1.  只能匹配路由前缀，不能匹配路由前缀长度
    2.  扩展 ACL
        1.  源部分、目的部分、前缀或掩码
2. 各种路由过滤工具
    1.  route-map：
        1.  作用
            1.  重分发是进行进行路由过滤
            2.  策略路由
            3.  NAT 转换
        2.  规则
            1.  从上到下依次匹配 match 语句，如果中了就执行 set 动作；否则进入下一跳
        3.  特点
            1.  使用match命令匹配特定的分组或路由, set修改该分组或路由相关属性。
            2.  Route-map中的每个序列号语句相当于于访问控制列表中的各行。
            3.  Route-map默认为permit ,默认序列号为10 ,序列号不会自动递增,需要指定序列号
            4.  末尾隐含deny any
            5.  单条match语句包括多个条件时,使用逻辑or运算; 多条match语句时,使用逻辑and运算。
    2.  distribute-list：分发列表
        1.  用于控制路由更新的一个工具
        2.  只能过滤路由信息,无法过滤LSA
    3.  prefix-list：前缀列表
        1.  前缀列表的可控性比访问列表高得多,支持增量修改,更为灵活
        2.  可匹配路由前缀中的网络号及前缀长度,增强了匹配的精确度
        3.  前缀列表包含序列号,从最小的开始匹配
        4.  如果前缀不与前缀列表中的任何条目匹配,将被拒绝
